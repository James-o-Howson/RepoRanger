using RepoRanger.Domain.Common;
using RepoRanger.Domain.Dependencies.ValueObjects;

namespace RepoRanger.Domain.Dependencies.Entities;

public class Vulnerability : BaseAuditableEntity
{
    private Vulnerability() { }

    public VulnerabilityId Id { get; } = VulnerabilityId.New;
    public string OsvId { get; private set; } = string.Empty;
    public DependencyVersionId DependencyVersionId { get; private set; }
    public DependencyVersion DependencyVersion { get; private set; } = null!;
    public DependencySourceId DependencySourceId { get; private set; }
    public DependencySource DependencySource { get; private set; } = null!;
    public DiscoveryState DiscoveryState { get; set; } = DiscoveryState.Initial;
    public DateTimeOffset? Published { get; private set; }
    public DateTimeOffset? Withdrawn { get; private set; }
    public string? Summary { get; private set; } = null;
    public string? Details { get; private set; } = null;

    internal static Vulnerability Create(string osvId, DependencyVersionId versionId, DependencySourceId dependencySourceId) => new()
    {
        OsvId = osvId,
        DependencyVersionId = versionId,
        DependencySourceId = dependencySourceId 
    };
}